name: Continuous Deployment to Docker Registry

on:
  push:
    branches:
      - main  # Ou qualquer outro branch que você esteja usando como principal

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      # Etapa 1: Fazer checkout do repositório
      - name: Checkout repository
        uses: actions/checkout@v2

      # Etapa 2: Configurar o Docker para usar sua credenciais (Docker Hub, ou outro registry)
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # Etapa 3: Login no Docker Registry (por exemplo, Docker Hub)
      - name: Log in to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # Etapa 4: Construir e enviar a imagem Docker para o registry (ajustar com seu repositório)
      - name: Build and push Docker image
        run: |
          docker build -t ${{ secrets.DOCKER_USERNAME }}/pedidos-microservice:latest .
          docker push ${{ secrets.DOCKER_USERNAME }}/pedidos-microservice:latest

      # Etapa 5: (removida) Configuração do kubectl, não será mais realizada no workflow

      # Etapa 6: (removida) Deploy para Kubernetes
      # Se for fazer o deploy manualmente, remova ou substitua esta parte.

      # Etapa 7: Verificar a imagem Docker no registry
      - name: Verify image in Docker Hub
        run: |
          docker pull ${{ secrets.DOCKER_USERNAME }}/pedidos-microservice:latest
